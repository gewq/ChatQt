# О программе
---
- Программа представляет собой сетевой чат, имеющий клиент-серверную архитектуру
- Программа реализует GUI посредством Qt
- Клиентская часть расположена в папке `client` - отвечает за пользовательский интерфейс и отправляет запросы серверу
- Серверная часть расположена в папке `server` - отвечает за работу с Базой данных пользователей и их сообщений
- Клиентская и серверная части компилируются отдельно друг от друга
- База данных реализована посредством **SQL**
- Сетевые настройки сервера заданы внутри исходного кода

# Клиент
---
- вход в чат по логину и паролю
- регистрация пользователей - логин, пароль
- отправка сообщений конкретному пользователю или всем сразу
- выход из чата 
- удаление аккаунта пользователя
- отправка запросов серверу

# Сервер
---
- обработка запросов клиентов
- обращение к Базе данных
- удаление пользователей
- удаление сообщений
- блокировка / разблокировка пользователей (бан)


# База данных
---
- База содержит данные пользователей и их сообщений друг другу

```sql
CREATE TABLE Users(
	#Логин пользователя
	Login TEXT,
	#Хеш пароля учётной записи
	PasswordHash TEXT,
	#Статус бана пользователя
	Ban BOOL
);
```

```sql
CREATE TABLE messages(\
	#Логин отправителя
	Sender TEXT,
	#Логин получателя
	Receiver TEXT,
	#Текст сообщения
	Message TEXT
);
```


# Описание выбранной идеи решения

## Клиент
---
- Пользователь может последовательно видеть 3 рабочих окна:
	- Окно Входа
	- Окно Регистрации пользователя
	- Окно Чата
- Логика работы каждого окна реализована в своём классе (`LoginWindow`, `RegistrationWindow`, `ChatWindow`)
- Смена окон происходит посредством переключения виджета `stackedWidget`
- `stackedWidget` расположен в отдельном окне логика работы которого реализована в классе `ScreenController`
- Переходы между окнами осуществляются по сигналам, которые отправляют классы рабочих окон. В классе `ScreenController` происходит приём сигналов и переход к другому окну

### Окно Входа
---
- Окно Входа содержит 
	- Поля для ввода данных пользователя
		- `Логин`
		- `Пароль`
	- Кнопки
		- `Ok` - проверка ввода пользователя и отправка запроса серверу
		- `Cancel` - завершить работу приложения
		- `Registration` - перейти к Окну Регистрации
- При вводе Логина / Пароля проверяется корректность ввода
	- Длина должна не менее 3 символов
	- Логин может содержать только символы `a`-`z`, `A`-`Z`, `0`-`9`
	- Логин не может начинаться с цифры
- Если проверка пройдена
	- Вычисляется хеш sha-1 введённого пароля
	- Отправляется запрос серверу на проверку Логина / Пароля
		- Если Логин / Пароль верны - отправляется сигнал `ScreenController` на переход в Окно Чата
		- Если Логин / Пароль неверны - пользователь получает сообщение об ошибочном вводе, после пользователь может исправить ввод
- При нажатии на кнопку `Registration` - отправляется сигнал `ScreenController` на переход в Окно Регистрации


### Окно Регистрации
---
- Окно Регистрации содержит 
	- Поля для ввода данных пользователя
		- `Логин`
		- `Пароль`
		- `Подтверждение пароля`
	- Кнопки
		- `Ok` - проверка ввода пользователя и отправка запроса серверу
		- `Cancel` - завершить работу приложения
		- `Log in` - перейти к Окну Входа
- При вводе Логина / Пароля проверяется корректность ввода
	- Длина должна не менее 3 символов
	- Логин может содержать только символы `a`-`z`, `A`-`Z`, `0`-`9`
	- Логин не может начинаться с цифры
	- Поля `Пароль` и `Подтверждение пароля` должны совпадать
- Если проверка пройдена
	- Вычисляется хеш sha-1 введённого пароля
	- Отправляется запрос серверу на добавление нового пользователя 
		- Если пользователь успешно зарегистрирован - отправляется сигнал `ScreenController` на переход в Окно Чата
		- Если введённый `Логин` уже зарегистрирован - пользователь получает сообщение об этом, после пользователь может исправить ввод
- При нажатии на кнопку `Log in` - отправляется сигнал `ScreenController` на переход в Окно Входа


### Окно Чата
---
- Окно Чата содержит 
	- Поле для ввода текста сообщения
	- Поля для отображения сообщений
		- Сообщения для всех
		- Личные сообщения текущего пользователя
	- Кнопки
		- `Send all` - проверка ввода текста сообщения и отправка сообщения серверу
		- `Send private` - проверка ввода текста сообщения и выбор адресата сообщения
		- `Remove account` - удалить учётную запись текущего пользователя перейти к Окну Входа
		- `Log out` - перейти к Окну Входа
- При вводе текста сообщения корректность ввода
	- Сообщение не должно быть пустым
- При нажатии на кнопку `Remove account` - отправляется запрос серверу на удаление пользователя и сигнал `ScreenController` на переход в Окно Входа
- При нажатии на кнопку `Log out` - отправляется сигнал `ScreenController` на переход в Окно Входа
- Каждые 50 мс происходит запрос серверу на предоставление актуальных сообщений 
	- для всех
	- личных для данного пользователя
- Если получены новые сообщения - они отображаются на экране


## Сервер
---
- Окно Сервера содержит 
	- Поля для отображения
		- Зарегистрированных пользователей
			- Логин
			- Хеш пароля
			- Статус - забанен / нет
		- Всех Сообщений, включая личные
			- Логин отправителя
			- Логин адресата
			- Текст сообщения
	- Кнопки
		- `Remove User` - удалить аккаунт выбранного пользователя
		- `Remove Message` - удалить выбранное сообщение
- При нажатии на кнопку `Remove User` - формируется окно подтверждения удаления. Если удаление подтверждено - пользователь и сообщения, адресованные ему безвозвратно удаляются.
- При нажатии на кнопку `Remove Message` - формируется окно подтверждения удаления. Если удаление подтверждено - сообщение удаляется
- Двойной клик мыши на строке Пользователя - банит/разбанит его
- Пользователь который забанен не может отправлять сообщения, но может заходить в чат и читать сообщения для всех


# Описание модулей и классов 

## Клиент
---
- `ScreenController` - управляет отображением окон GUI
	- Обеспечивает переключение `stackedWidget` по сигналам окон
- `LoginWindow` - логика работы Окна Ввода данных пользователя
- `RegistrationWindow` - логика работы Окна Регистрации пользователя
- `ChatWindow`- логика работы Окна Чата
- `InputChecker` - методы проверки корректности ввода Логина / Пароля
- `SHA_1_Wrapper` - расчёт хеша sha-1 заданной строки
- `Client` - взаимодействие с сервером по сети
	- Отправляет запросы серверу
	- Принимает ответ сервера


## Сервер
---
- `MainWindow` - логика работы GUI
- `Server` - взаимодействие с клиентами по сети
	- Принимает запросы серверу и делегирует их `RequestHandler`
	- Отправляет ответы, сформированные `RequestHandler`, клиентам 
- `RequestHandler` - обработка запросов серверу и формирование ответов
- `Database` - взаимодействие с SQL базой данных пользователей и их сообщений
	- При внесении изменений в базу данных отправляет сигнал `MainWindow` на обновление данных на экране
- `SHA_1_Wrapper` - расчёт хеша sha-1 заданной строки


# Установка Qt в Ubuntu
---
- `sudo apt update`
- Перед тем как начать устанавливать Qt в системе должен быть установлен компилятор
	- `sudo apt install build-essential gdb`
- и cmake
	- `sudo apt install cmake`
- `sudo apt-get install build-essential`
- `sudo apt install -y qtcreator qtbase5-dev qt5-qmake`
- Запустить Qt Creator -> `Tools` -> `Options` ->`Qt Versions` ->`Manual (Add)` ->`/usr/lib/qt5/bin/qmake`
